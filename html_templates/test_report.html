<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.TestName}} - Visual Test Report</title>
    <style>
        * { box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 12px;
            background: #0d1117;
            color: #e6edf3;
            line-height: 1.4;
        }

        /* Clean Header */
        .header {
            border-bottom: 1px solid #30363d;
            padding-bottom: 12px;
            margin-bottom: 16px;
        }

        .header h1 {
            margin: 0 0 6px 0;
            font-size: 20px;
            font-weight: 600;
            color: #f0f6fc;
        }

        .test-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            font-size: 13px;
            color: #8b949e;
        }

        .meta-item {
            display: flex;
            flex-direction: column;
            gap: 1px;
        }

        .meta-label {
            font-size: 11px;
            text-transform: uppercase;
            color: #7d8590;
        }

        .meta-value {
            font-weight: 600;
            color: #e6edf3;
            font-family: ui-monospace, SFMono-Regular, "SF Mono", Consolas, monospace;
        }

        .status-success { color: #3fb950; }
        .status-failed { color: #f85149; }

        /* Clean Test Flow Container */
        /* Timeline Container */
        .timeline-container {
            border: 1px solid #30363d;
            margin-bottom: 16px;
            background: #161b22;
        }

        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #30363d;
            background: #161b22;
            flex-shrink: 0;
        }

        .timeline-header h2 {
            margin: 0;
            font-size: 14px;
            font-weight: 600;
            color: #f0f6fc;
        }

        .timeline-controls {
            display: flex;
            gap: 8px;
        }

        .control-btn {
            background: #21262d;
            color: #e6edf3;
            border: 1px solid #30363d;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
        }

        .control-btn:hover {
            background: #30363d;
        }

        .control-btn.playing {
            background: #0d4429;
            border-color: #3fb950;
            color: #3fb950;
        }

        /* Frame Display */
        .frame-viewer {
            position: relative;
            background: #161b22;
            border: 1px solid #30363d;
            height: 280px; /* More height for frame */
            overflow: hidden;
        }

        .frame-element {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 8px;
        }

        .frame-element.active {
            display: block;
        }

        .frame-img {
            width: 100%;
            height: 200px; /* More compact height */
            object-fit: contain;
            object-position: top left;
            background: #0d1117;
            border: 1px solid #30363d;
        }

        /* ANSI Terminal Content Styling */
        .ansi-terminal-content {
            width: 100%;
            height: 200px;
            background: #000;
            font-family: 'SFMono-Regular', 'Monaco', 'Inconsolata', 'Fira Code', 'Fira Mono', 'Droid Sans Mono', 'Consolas', monospace;
            font-size: 11px;
            line-height: 1.2;
            padding: 8px;
            overflow-y: auto;
            border: 1px solid #30363d;
            border-radius: 4px;
        }

        /* Terminal colors - use standard terminal palette for buildkite/terminal-to-html */
        .ansi-terminal-content .term-fgx30 { color: #000; }
        .ansi-terminal-content .term-fgx31 { color: #c91b00; }
        .ansi-terminal-content .term-fgx32 { color: #00c200; }
        .ansi-terminal-content .term-fgx33 { color: #c7c400; }
        .ansi-terminal-content .term-fgx34 { color: #0037da; }
        .ansi-terminal-content .term-fgx35 { color: #c800c7; }
        .ansi-terminal-content .term-fgx36 { color: #00c5c7; }
        .ansi-terminal-content .term-fgx37 { color: #c7c7c7; }
        .ansi-terminal-content .term-fgx39 { color: #79c0ff; } /* Blue for QNTX branding */
        .ansi-terminal-content .term-fgx90 { color: #767676; }
        .ansi-terminal-content .term-fgx91 { color: #ff6d6b; }
        .ansi-terminal-content .term-fgx92 { color: #00ff41; }
        .ansi-terminal-content .term-fgx93 { color: #fffc00; }
        .ansi-terminal-content .term-fgx94 { color: #0078ff; }
        .ansi-terminal-content .term-fgx95 { color: #ff77ff; }
        .ansi-terminal-content .term-fgx96 { color: #00ffff; }
        .ansi-terminal-content .term-fgx97 { color: #fff; }
        .ansi-terminal-content .term-fgx240 { color: #8b949e; } /* Gray for help text */
        .ansi-terminal-content .term-fgx244 { color: #7d8590; } /* Dimmer gray */
        .ansi-terminal-content .term-fgx255 { color: #e6edf3; } /* White for input */

        /* Bold/bright text styles */
        .ansi-terminal-content .term-fg1 { font-weight: bold; }
        .ansi-terminal-content .term-fg3 { font-style: italic; }

        /* General terminal text styling */
        .ansi-terminal-content span {
            white-space: pre;
            font-family: inherit;
        }

        .frame-info {
            color: #8b949e;
            text-align: center;
        }

        .frame-title {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .frame-desc {
            font-size: 11px;
            opacity: 0.8;
        }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            background: #21262d;
            border-radius: 4px;
            height: 4px;
            margin: 12px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: #388bfd;
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        /* Thumbnail Navigation */
        .thumbnail-nav {
            display: flex;
            gap: 6px;
            justify-content: center;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        .thumbnail {
            width: 80px;
            height: 50px;
            border-radius: 4px;
            cursor: pointer;
            opacity: 0.6;
            transition: all 0.2s;
            border: 1px solid transparent;
            object-fit: cover;
        }

        .thumbnail:hover {
            opacity: 0.8;
            transform: scale(1.02);
        }

        .thumbnail.active {
            opacity: 1;
            border-color: #388bfd;
        }

        /* ANSI Thumbnail Styling */
        .ansi-thumbnail {
            width: 80px;
            height: 50px;
            border-radius: 4px;
            cursor: pointer;
            opacity: 0.6;
            transition: all 0.2s;
            border: 1px solid transparent;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'SFMono-Regular', monospace;
            font-size: 10px;
            color: #00ff41;
        }

        .ansi-thumbnail:hover {
            opacity: 0.8;
            transform: scale(1.02);
        }

        .ansi-thumbnail.active {
            opacity: 1;
            border-color: #388bfd;
            background: #111;
        }

        /* Two-Panel Layout: Main Display Left, Timeline Right */
        .timeline-container {
            display: flex;
            gap: 0;
            border: 1px solid #30363d;
            margin-bottom: 16px;
            background: #161b22;
            border-radius: 6px;
            height: 600px;
            width: 100%;
        }

        .main-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0; /* Allow flex child to shrink */
        }

        .timeline-panel {
            width: 320px;
            flex-shrink: 0; /* Don't allow panel to shrink */
            display: flex;
            flex-direction: column;
            border-left: 1px solid #30363d;
            background: #0d1117;
        }

        /* Vertical Film Strip on Right */
        .timeline-strip {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            padding: 12px 8px;
            gap: 6px;
            background: #0d1117;
            /* Custom scrollbar */
            scrollbar-width: thin;
            scrollbar-color: #30363d #0d1117;
            position: relative;
        }

        /* Film content container - no animation, let auto-focus handle positioning */
        .film-content {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .timeline-strip::-webkit-scrollbar {
            width: 6px;
        }

        .timeline-strip::-webkit-scrollbar-track {
            background: #0d1117;
        }

        .timeline-strip::-webkit-scrollbar-thumb {
            background: #30363d;
            border-radius: 3px;
        }

        .timeline-strip::-webkit-scrollbar-thumb:hover {
            background: #484f58;
        }

        /* Remove filmRoll animation - using auto-focus instead */

        /* Animation states no longer needed */

        .timeline-frame {
            flex-shrink: 0;
            width: 280px;
            height: 160px;
            border: 2px solid #30363d;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            background: #161b22;
            margin: 2px 0;
            /* Film strip perforations effect */
            position: relative;
        }

        .timeline-frame::before,
        .timeline-frame::after {
            content: '';
            position: absolute;
            top: 0;
            width: 6px;
            height: 100%;
            background: repeating-linear-gradient(
                to bottom,
                #21262d 0px,
                #21262d 8px,
                transparent 8px,
                transparent 16px
            );
        }

        .timeline-frame::before {
            left: -8px;
        }

        .timeline-frame::after {
            right: -8px;
        }

        .timeline-frame:hover {
            border-color: #388bfd;
            transform: scale(1.02);
        }

        .timeline-frame.active {
            border-color: #3fb950;
            box-shadow: 0 0 12px rgba(63, 185, 80, 0.3);
        }

        .frame-content {
            width: 100%;
            height: 110px;
            font-family: 'SFMono-Regular', 'Monaco', 'Inconsolata', 'Fira Code', 'Fira Mono', 'Droid Sans Mono', 'Consolas', monospace;
            font-size: 8px;
            line-height: 1.2;
            padding: 4px;
            background: #000;
            overflow: hidden;
            border-radius: 4px 4px 0 0;
            color: #e6edf3;
            border: 1px solid #21262d;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .frame-label {
            padding: 4px 8px;
            font-size: 10px;
            color: #e6edf3;
            background: #21262d;
            border-radius: 0 0 4px 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .frame-timing {
            position: absolute;
            top: 2px;
            right: 2px;
            background: rgba(0,0,0,0.8);
            color: #79c0ff;
            padding: 1px 4px;
            border-radius: 3px;
            font-size: 8px;
            font-family: monospace;
        }

        /* Main Display Area */
        .main-display {
            flex: 1;
            background: #161b22;
            display: flex;
            flex-direction: column;
        }

        .display-header {
            padding: 12px;
            border-bottom: 1px solid #30363d;
            background: #161b22;
        }

        .display-content {
            flex: 1;
            background: #000;
            font-family: 'SFMono-Regular', 'Monaco', 'Inconsolata', 'Fira Code', 'Fira Mono', 'Droid Sans Mono', 'Consolas', monospace;
            font-size: 14px;
            line-height: 1.2;
            padding: 16px;
            overflow: auto;
            color: #e6edf3;
        }

        /* Two Panel Layout - Visual Left, Code Right */
        .test-flow-container {
            display: block;
            margin-bottom: 16px;
        }

        .visual-panel {
            background: transparent;
        }

        .code-panel {
            background: #161b22;
            border: 1px solid #30363d;
            border-left: 3px solid #388bfd;
            height: fit-content;
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            border-bottom: 1px solid #30363d;
            background: #0d1117;
        }

        .code-header h3 {
            margin: 0;
            font-size: 12px;
            font-weight: 600;
            color: #f0f6fc;
        }

        /* Source Code Display */
        .source-code {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 4px;
            padding: 8px;
            font-family: ui-monospace, SFMono-Regular, 'SF Mono', Consolas, monospace;
            font-size: 10px;
            height: 400px;
            overflow-y: auto;
            position: sticky;
            top: 16px;
        }

        .source-line {
            display: flex;
            align-items: flex-start;
            margin: 1px 0;
            padding: 1px 0;
            border-radius: 2px;
        }

        .source-line.executing {
            background: #1a2b1a;
            border-left: 3px solid #3fb950;
            padding-left: 5px;
        }

        .line-num {
            color: #7d8590;
            min-width: 30px;
            text-align: right;
            margin-right: 8px;
            font-size: 10px;
        }

        .source-text {
            color: #e6edf3;
            flex: 1;
        }

        .source-text .keyword {
            color: #ff7b72;
        }

        .source-text .string {
            color: #a5d6ff;
        }

        .source-text .comment {
            color: #8b949e;
            font-style: italic;
        }

        .source-text .function {
            color: #d2a8ff;
        }

        .source-text .method {
            color: #79c0ff;
        }

        /* Clickable source lines */
        .source-line.clickable {
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .source-line.clickable:hover {
            background: #1c2128;
        }

        .copy-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #238636;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .copy-indicator.show {
            opacity: 1;
        }

        .code-step-indicator {
            font-size: 11px;
            color: #8b949e;
            font-family: ui-monospace, SFMono-Regular, "SF Mono", Consolas, monospace;
        }

        .code-step {
            font-family: ui-monospace, SFMono-Regular, 'SF Mono', Consolas, 'Liberation Mono', Menlo, monospace;
            padding: 8px;
        }

        .code-line {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }

        .line-number {
            background: #21262d;
            color: #8b949e;
            padding: 1px 4px;
            border-radius: 2px;
            font-size: 10px;
            min-width: 20px;
            text-align: center;
        }

        .code-action {
            font-weight: 600;
            color: #7ee787;
        }

        .code-description {
            font-size: 11px;
            color: #8b949e;
            margin: 4px 0;
            line-height: 1.3;
        }

        .code-example {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 4px;
            padding: 6px;
            margin-top: 4px;
        }

        .code-example code {
            color: #f0883e;
            font-size: 10px;
        }

        .interactions-context {
            margin: 6px 0;
            padding: 6px;
            background: #0d1117;
            border-left: 2px solid #388bfd;
            border-radius: 0 4px 4px 0;
        }

        .interaction-entry {
            display: flex;
            align-items: center;
            gap: 6px;
            margin: 2px 0;
            font-size: 10px;
        }

        .interaction-type {
            background: #388bfd;
            color: white;
            padding: 1px 4px;
            border-radius: 2px;
            font-size: 9px;
            min-width: 50px;
            text-align: center;
        }

        .interaction-entry code {
            color: #79c0ff;
            background: transparent;
        }

        /* Stats Panel */
        .stats-panel {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 12px;
        }

        .stats-panel h3 {
            margin: 0 0 8px 0;
            font-size: 14px;
            color: #f0f6fc;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
        }

        .stat-item {
            text-align: center;
            padding: 8px;
            background: #21262d;
            border-radius: 4px;
        }

        .stat-value {
            font-size: 16px;
            font-weight: 600;
            color: #388bfd;
            margin-bottom: 2px;
        }

        .stat-label {
            font-size: 11px;
            color: #8b949e;
        }

        @media (max-width: 768px) {
            .test-meta {
                flex-direction: column;
                gap: 8px;
            }

            .slideshow-header {
                flex-direction: column;
                gap: 8px;
            }
        }

        /* Terminal styles */
        .terminal-container {
            background: #000;
            border-radius: 4px;
            border: 1px solid #30363d;
            padding: 8px;
            font-family: 'Courier New', monospace;
            min-height: 300px;
        }

        .terminal-screen {
            width: 100%;
            height: 300px;
        }

        .terminal-placeholder {
            color: #666;
            font-style: italic;
            padding: 20px;
            text-align: center;
            background: #0a0a0a;
            border-radius: 4px;
        }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css" />
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.js"></script>
</head>
<body>
    <div class="header">
        <div style="margin-bottom: 6px;">
            <a href="../../index.html" style="color: #79c0ff; text-decoration: none; font-size: 12px;">← Back to Dashboard</a>
        </div>
        <h1>{{.TestName}}</h1>
        <div class="test-meta">
            <div class="meta-item">
                <span class="meta-label">Timestamp</span>
                <span class="meta-value">{{.Timestamp}}</span>
            </div>
            <div class="meta-item">
                <span class="meta-label">Duration</span>
                <span class="meta-value">{{printf "%.0fms" (mul .Duration.Seconds 1000)}}</span>
            </div>
            <div class="meta-item">
                <span class="meta-label">Status</span>
                <span class="meta-value {{if .Success}}status-success{{else}}status-failed{{end}}">
                    {{if .Success}}PASSED{{else}}FAILED{{end}}
                </span>
            </div>
            <div class="meta-item">
                <span class="meta-label">Frames</span>
                <span class="meta-value">{{len .Screenshots}}</span>
            </div>
        </div>
    </div>

    {{if not .Success}}
    <!-- Error Analysis Section -->
    <div class="error-analysis-container" style="background: #1c1815; border: 1px solid #d1242f; border-radius: 6px; margin-bottom: 16px; padding: 16px;">
        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
            <span style="color: #f85149; font-size: 18px;">⚠️</span>
            <h2 style="margin: 0; font-size: 16px; color: #f85149;">Test Failure Analysis</h2>
        </div>

        {{if .ErrorMessage}}
        <div style="background: #2d1b1e; border-left: 3px solid #f85149; padding: 12px; margin-bottom: 12px; border-radius: 4px;">
            <h3 style="margin: 0 0 6px 0; font-size: 14px; color: #f85149;">Error Summary</h3>
            <pre style="margin: 0; white-space: pre-wrap; font-family: ui-monospace, monospace; font-size: 12px; color: #e6edf3;">{{.ErrorMessage}}</pre>
        </div>
        {{end}}

        {{if .ErrorDetails}}
        <div style="background: #2d1b1e; border-left: 3px solid #ff7b72; padding: 12px; margin-bottom: 12px; border-radius: 4px;">
            <h3 style="margin: 0 0 6px 0; font-size: 14px; color: #ff7b72;">Technical Details</h3>
            <pre style="margin: 0; white-space: pre-wrap; font-family: ui-monospace, monospace; font-size: 11px; color: #e6edf3; max-height: 200px; overflow-y: auto;">{{.ErrorDetails}}</pre>
        </div>
        {{end}}

        {{if .TripReport}}
        <div style="background: #2d1b1e; border-left: 3px solid #f0883e; padding: 12px; border-radius: 4px;">
            <h3 style="margin: 0 0 6px 0; font-size: 14px; color: #f0883e;">Trip Handler Report</h3>
            <pre style="margin: 0; white-space: pre-wrap; font-family: ui-monospace, monospace; font-size: 11px; color: #e6edf3; max-height: 200px; overflow-y: auto;">{{.TripReport}}</pre>
        </div>
        {{end}}
    </div>
    {{end}}

    <div class="timeline-container">
        <!-- Main Display Panel -->
        <div class="main-panel">
            <div class="timeline-header">
                <h2>ANSI Live Timeline</h2>
                <div class="timeline-controls">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 12px; color: #79c0ff; font-family: monospace;" id="timeCounter">0ms</span>
                        <button class="control-btn" id="playBtn" onclick="toggleTimeline()">Play Film</button>
                        <button class="control-btn" onclick="prevFrame()">Previous</button>
                        <button class="control-btn" onclick="nextFrame()">Next</button>
                        <button class="control-btn" onclick="resetTimeline()">Reset</button>
                    </div>
                </div>
            </div>

            <div class="main-display">
                <div class="display-header">
                    <h3 id="currentFrameTitle">Frame 0: Select a frame from film strip</h3>
                </div>
                <div class="display-content" id="mainDisplay">
                    <div style="color: #666; text-align: center; padding: 40px;">
                        Click on a frame in the film strip to view the ANSI content
                    </div>
                </div>
            </div>
        </div>

        <!-- Timeline Panel (Right Side) -->
        <div class="timeline-panel">
            <div class="timeline-header">
                <h2 style="font-size: 12px; margin: 0; padding: 12px;">Film Strip</h2>
            </div>

            <!-- Vertical Film Strip -->
            <div class="timeline-strip" id="timelineStrip">
                <div class="film-content" id="filmContent">
                    <!-- First copy of frames -->
                    {{range $index, $screenshot := .Screenshots}}
                    <div class="timeline-frame" data-index="{{$index}}" onclick="selectFrame({{$index}})">
                        <div class="frame-timing">{{extractTiming $screenshot.Label}}ms</div>
                        <div class="frame-content">
                            {{if $screenshot.IsANSI}}
                            {{$screenshot.HTMLContent}}
                            {{else}}
                            <div style="color: #666; font-style: italic; text-align: center; padding: 20px; font-size: 8px;">No ANSI</div>
                            {{end}}
                        </div>
                        <div class="frame-label">{{$screenshot.Label}}</div>
                    </div>
                    {{end}}
                    <!-- Second copy for seamless loop -->
                    {{range $index, $screenshot := .Screenshots}}
                    <div class="timeline-frame" data-index="{{add $index (len $.Screenshots)}}" onclick="selectFrame({{$index}})">
                        <div class="frame-timing">{{extractTiming $screenshot.Label}}ms</div>
                        <div class="frame-content">
                            {{if $screenshot.IsANSI}}
                            {{$screenshot.HTMLContent}}
                            {{else}}
                            <div style="color: #666; font-style: italic; text-align: center; padding: 20px; font-size: 8px;">No ANSI</div>
                            {{end}}
                        </div>
                        <div class="frame-label">{{$screenshot.Label}}</div>
                    </div>
                    {{end}}
                </div>
            </div>
        </div>
    </div>

    <div class="stats-panel">
        <h3>Test Statistics</h3>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-value">{{printf "%.0f" (mul .Duration.Seconds 1000)}}</div>
                <div class="stat-label">Execution Time (ms)</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{len .Screenshots}}</div>
                <div class="stat-label">Frames Captured</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{len .Interactions}}</div>
                <div class="stat-label">Interactions Recorded</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{if .Success}}100{{else}}0{{end}}%</div>
                <div class="stat-label">Success Rate</div>
            </div>
        </div>
    </div>

    {{if .Interactions}}
    <div class="stats-panel" style="margin-top: 20px;">
        <h3>Test Execution Log</h3>
        <div style="max-height: 300px; overflow-y: auto; font-family: ui-monospace, SFMono-Regular, 'SF Mono', Consolas, 'Liberation Mono', Menlo, monospace; font-size: 10px;">
        {{range .Interactions}}
            <div style="margin: 4px 0; padding: 6px; border-left: 2px solid {{if eq .Type "real_frame"}}#3fb950{{else}}#388bfd{{end}}; background: #21262d;">
                <div style="color: #e6edf3;"><strong>{{.Timestamp.Format "15:04:05.000"}}</strong> - {{.Type}}</div>
                {{if eq .Type "frame_error"}}
                    <div style="margin-top: 2px; color: #f85149; font-size: 11px;">
                        <strong>Frame Generation Failed</strong><br>
                        {{if .Details.label}}<strong>Label:</strong> {{.Details.label}}<br>{{end}}
                        {{if .Details.error}}<strong>Error:</strong> <code>{{.Details.error}}</code><br>{{end}}
                        {{if .Details.output}}<strong>Output:</strong> <code style="background: #0d1117; padding: 1px 2px; border-radius: 2px;">{{.Details.output}}</code>{{end}}
                    </div>
                {{else if eq .Type "real_frame"}}
                    <div style="color: #3fb950; font-size: 11px;">Frame: {{.Details}}</div>
                {{else}}
                    <div style="color: #8b949e; font-size: 11px;">{{.Details}}</div>
                {{end}}
            </div>
        {{end}}
        </div>
    </div>
    {{end}}

    <!-- Copy indicator -->
    <div id="copyIndicator" class="copy-indicator">Copied to clipboard!</div>

    <script src="terminal-timeline.js"></script>
    <script>
        // Initialize the application with template data
        const frameData = [
            {{range $index, $screenshot := .Screenshots}}
            {
                label: "{{$screenshot.Label}}",
                content: `{{$screenshot.HTMLContent}}`,
                isANSI: {{$screenshot.IsANSI}},
                timing: "{{extractTiming $screenshot.Label}}"
            },
            {{end}}
        ];

        const totalFrames = {{len .Screenshots}};
        const testDurationMs = {{printf "%.0f" (mul .Duration.Seconds 1000)}};

        // Initialize the timeline application
        initializeApp(totalFrames, testDurationMs, frameData);
    </script>
</body>
</html>